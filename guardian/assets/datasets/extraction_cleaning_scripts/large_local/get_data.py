import urllib
import urllib2
import os

url = "http://www.ucrdatatool.gov/Search/Crime/Local/DownCrimeOneYearofDataLarge.cfm/LocalCrimeOneYearofData.csv"

values = {
	"CrimeCrossId" : "40,136,310,321,358,374,375,381,725,886,910,911,927,929,945,946,948,950,961,971,973,978,995,1010,1013,1028,1042,1056,1103,1116,1117,1135,1138,1143,1146,1158,1177,1227,1231,1233,1240,1245,1252,1261,1263,1265,1267,1269,1272,1289,1306,1317,1322,1330,1362,1380,1389,1391,1434,1446,1452,1471,1476,1477,1481,1483,1486,1491,1496,1503,1515,1524,1531,1540,1541,1548,1550,1557,1561,1562,1563,1572,1574,1581,1584,1596,1604,1610,1615,1621,1630,1632,1639,1642,1643,1647,1652,1672,1703,1744,1750,1753,1763,1765,1767,1773,1817,1820,1823,1825,1833,1874,1878,1888,22564,1918,1941,1947,1955,1969,2009,2024,2089,2122,2141,2157,2194,2214,2244,2257,2277,2327,2349,2406,2428,2440,2450,2456,2461,2463,2475,2487,2572,2704,2724,2790,2793,2808,2811,2560,2881,2904,2948,2956,2962,2972,2976,2983,3026,3042,3045,3051,3056,3062,3078,3081,3091,3101,3104,3132,3139,3152,3169,3182,3201,3204,3248,3274,3310,3312,3398,3414,3423,3434,3436,3473,3532,3612,3620,3639,3792,3833,3858,4037,4044,4101,4134,4141,4396,4411,4583,4701,4732,4846,5032,5066,5216,5303,5368,5453,5586,5769,5774,5789,5876,5952,6134,6144,6306,6430,6523,6612,6643,6970,22787,6985,7244,7309,7376,7391,7403,7453,7506,7533,7633,7655,7798,7948,8036,8049,8055,8057,8085,8112,8130,8133,8161,8179,8202,8222,8451,8621,8670,8713,8813,8836,8862,8878,8943,8999,9022,9144,9195,9196,9539,9627,9672,9745,9883,10027,10036,10043,10263,10291,10293,10306,10518,10702,11261,11291,11304,11365,11386,11418,11472,11478,11509,11530,11541,11710,11763,11890,11908,11948,11956,12012,10928,11017,11063,12262,12517,12520,12629,12750,12797,13003,13015,13020,13168,13171,13183,13187,13193,13222,13307,13478,13505,13755,13776,13794,13883,13987,14019,14099,14155,14294,14305,14463,14477,14499,14532,14649,15112,15146,15319,15559,15574,15692,15777,15826,15847,15954,15968,16022,16061,16513,17184,17198,17736,17758,17767,17784,17790,17815,17847,17910,17932,17973,18014,18050,18079,18141,18293,18378,18383,18466,18509,18510,18552,18573,18576,18631,18713,18733,18752,18763,18784,18803,18824,18843,18865,18874,18902,18916,18965,19000,19016,19059,19061,19096,19109,19123,19144,19187,19215,19242,19262,19320,19366,19378,19411,19444,19449,19462,19466,19484,19543,19575,19592,19632,19662,19680,19846,19863,19941,19945,20075,20085,20087,20132,20133,20139,20142,20157,20220,20223,20280,20332,20343,20385,20430,20436,20484,20501,20541,20544,20576,20718,20750,20786,20816,20819,20821,20888,20915,20924,20929,20930,20942,20945,20959,21179,21256,21295",
	"YearStart" : "2012",
	"YearEnd" : "2012", 
	"DataType" : "1,2,3,4"
}

def get_data(year):

	values["YearStart"] = year
	values["YearEnd"] = year

	data = urllib.urlencode(values)

	req = urllib2.Request(url, data)
	req.add_header('Host', 'www.ucrdatatool.gov')
	req.add_header('Cache-Control', 'max-age=0')
	req.add_header('Accept', 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8')
	req.add_header('Origin', 'http://www.ucrdatatool.gov')
	req.add_header('User-Agent', 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.111 Safari/537.36')
	req.add_header('Content-Type', 'application/x-www-form-urlencoded')
	req.add_header('Referer', 'http://www.ucrdatatool.gov/Search/Crime/Local/RunCrimeOneYearofDataLarge.cfm')
	req.add_header('Accept-Encoding', 'gzip,deflate')
	req.add_header('Accept-Language', 'en-US,en;q=0.8')
	req.add_header('Cookie', 'topItem=-1c; CFID=58464003; CFTOKEN=8763b89c94d72ce6-A3996A1D-B70C-976D-8208D06DE0B7074F')

	response = urllib2.urlopen(req)

	f_out = open(year+".csv", 'w')

	for line in response:
		if (len(line.split(",")) >= 4):
			f_out.write(line)

	f_out.close()


year = 2014
while(True):
	try:
		get_data(str(year))
		year -=1
		print str(year) + " found"
	except:
		print str(year) + " caused exception"
		year -=1